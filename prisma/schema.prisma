generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model WorkspaceConfig {
  id          String   @id @default("default")
  seedVersion String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Topic {
  id          String   @id
  name        String
  description String?
  parentId    String?
  tags        String?
  color       String?
  createdAt   DateTime
  updatedAt   DateTime

  tasks Task[]
  logs  ActivityLog[]
  events Event[]
}

model Task {
  id        String   @id
  topicId   String
  title     String
  status    String
  color     String?
  createdAt DateTime
  updatedAt DateTime

  topic Topic @relation(fields: [topicId], references: [id], onDelete: Cascade)
  @@index([topicId])
}

model ActivityLog {
  id         String   @id
  topicId    String?
  message    String
  createdAt  DateTime
  agentId    String?
  agentLabel String?
  sessionKey String?
  messageId  String?
  channel    String?

  topic Topic? @relation(fields: [topicId], references: [id], onDelete: SetNull)
  @@index([topicId])
}

model Event {
  id         String   @id
  type       String
  content    String
  timestamp  DateTime
  topicId    String?
  agentId    String?
  agentLabel String?
  source     String
  sourceId   String   @unique
  createdAt  DateTime
  updatedAt  DateTime

  topic Topic? @relation(fields: [topicId], references: [id], onDelete: SetNull)
  @@index([topicId])
  @@index([timestamp])
}

model ImportJob {
  id         String   @id
  status     String
  cursor     String?
  summary    String?
  error      String?
  createdAt  DateTime
  updatedAt  DateTime
  startedAt  DateTime?
  finishedAt DateTime?

  @@index([createdAt])
}

# Example environment for Clawboard
# Copy to .env and fill in values.

# Shared API token:
# - required for all write endpoints
# - required for non-localhost reads (including Tailscale/custom-domain access)
# - localhost reads are allowed without token
CLAWBOARD_TOKEN=your-token-here

# Optional: frontend default token to prefill Setup/local storage on first load.
# Security warning: this is embedded in the browser bundle; only use on private/trusted networks.
NEXT_PUBLIC_CLAWBOARD_DEFAULT_TOKEN=

# Unified view pagination: topics per page (higher renders more topics per page).
NEXT_PUBLIC_CLAWBOARD_UNIFIED_TOPICS_PAGE_SIZE=50

# Optional: database (defaults to sqlite)
# CLAWBOARD_DB_URL=postgresql+psycopg://clawboard:clawboard@db:5432/clawboard

# Optional (sqlite only): busy timeout in seconds for write contention.
# Keep it low so upstream queues/retries can recover quickly.
# CLAWBOARD_SQLITE_TIMEOUT_SECONDS=3

# Public API base for the web UI.
# IMPORTANT: must be reachable from the *browser*. If you access Clawboard over
# Tailscale, set this to your tailnet IP/hostname (e.g. http://100.x.y.z:8010).
CLAWBOARD_PUBLIC_API_BASE=http://localhost:8010

# Optional: public/browser-facing UI URL (for installer summaries and docs).
CLAWBOARD_PUBLIC_WEB_URL=http://localhost:3010

# Web UI dev mode (hot reload)
# 0 = production-style container (default), 1 = Next.js dev server with hot reload.
CLAWBOARD_WEB_HOT_RELOAD=1

# Extra allowed dev origins/hosts for the Next dev server (CSV).
# You can provide full origins (e.g. https://my-host.ts.net:3010) or hostnames (e.g. my-host.ts.net).
CLAWBOARD_ALLOWED_DEV_ORIGINS=

# OpenClaw gateway base URL for the classifier worker (docker).
OPENCLAW_BASE_URL=http://host.docker.internal:18789
# Token from ~/.openclaw/openclaw.json -> gateway.auth.token
OPENCLAW_GATEWAY_TOKEN=your-openclaw-gateway-token
# Enable device auth by mounting ~/.openclaw into the API container.
OPENCLAW_GATEWAY_USE_DEVICE_AUTH=1
# Minimum connect scopes for gateway clients; write is required for chat.send.
OPENCLAW_GATEWAY_SCOPES=operator.read,operator.write
OPENCLAW_GATEWAY_IDENTITY_DIR=/root/.openclaw
# Optional: OpenClaw chat dispatch timeout (seconds) for POST /v1/responses (clamped 5..600).
# OPENCLAW_CHAT_TIMEOUT_SECONDS=120
# Optional: after a *successful* gateway call, wait this many seconds for assistant logs to land in Clawboard
# via the logger plugin. If none arrive, Clawboard emits an actionable system warning. Set to 0 to disable.
OPENCLAW_CHAT_ASSISTANT_LOG_GRACE_SECONDS=30

# OpenClaw clawboard-logger plugin: context injection tuning.
#
# These values do NOT affect the Clawboard server directly. They are consumed by
# scripts/bootstrap_openclaw.sh when writing the OpenClaw plugin config
# (plugins.entries.clawboard-logger.config.*).
#
# Modes:
# - auto: cheap continuity by default; semantic recall when needed (recommended)
# - cheap: fastest; no semantic recall
# - full: always semantic recall
# - patient: deeper recall (server may use larger bounded limits; allow more time)
CLAWBOARD_LOGGER_CONTEXT_MODE=auto
CLAWBOARD_LOGGER_CONTEXT_FALLBACK_MODE=cheap
CLAWBOARD_LOGGER_CONTEXT_FETCH_TIMEOUT_MS=1200
CLAWBOARD_LOGGER_CONTEXT_TOTAL_BUDGET_MS=2200
CLAWBOARD_LOGGER_CONTEXT_MAX_CHARS=2200

# Classifier worker cadence + retry policy
CLASSIFIER_INTERVAL_SECONDS=10
CLASSIFIER_MAX_ATTEMPTS=3

# Optional: classifier decision audit log (JSONL). Useful for tuning and debugging.
# In docker-compose, /data is bind-mounted to ./data on the host (purge-state.sh archives/purges it).
# CLASSIFIER_AUDIT_PATH=/data/classifier-audit.jsonl

# Optional: topic/task digests (compressed memory). System-managed; does not affect embeddings.
# Default is enabled, but you can disable in prod if you want strictly manual memory.
# CLASSIFIER_DIGEST_ENABLED=1
# Minimum seconds between digest refresh attempts for the same topic/task.
# CLASSIFIER_DIGEST_MIN_SECONDS=900
# Max topics+tasks to update per classifier cycle (keep low to avoid churn).
# CLASSIFIER_DIGEST_MAX_PER_CYCLE=2
# How many recent conversation logs to consider when generating digests.
# CLASSIFIER_DIGEST_TOPIC_LOOKBACK_LOGS=120
# CLASSIFIER_DIGEST_TASK_LOOKBACK_LOGS=90
# Maximum digest size stored on Topic/Task.
# CLASSIFIER_DIGEST_MAX_CHARS=1800

# Event stream buffer size (SSE replay)
CLAWBOARD_EVENT_BUFFER=500
# Optional: per-subscriber SSE queue depth (defaults to CLAWBOARD_EVENT_BUFFER)
# CLAWBOARD_EVENT_SUBSCRIBER_QUEUE=500

# Optional: async ingest queue
# CLAWBOARD_INGEST_MODE=queue
# CLAWBOARD_QUEUE_POLL_SECONDS=1.5
# CLAWBOARD_QUEUE_BATCH=25

# Optional: path to the reindex queue jsonl file (defaults to ./data/reindex-queue.jsonl)
# CLAWBOARD_REINDEX_QUEUE_PATH=./data/reindex-queue.jsonl

# Optional: background snooze worker (re-activates items when snoozedUntil expires)
# CLAWBOARD_DISABLE_SNOOZE_WORKER=0
# CLAWBOARD_SNOOZE_POLL_SECONDS=15

# Classifier context and embeddings (optional)
CLASSIFIER_WINDOW_SIZE=24
CLASSIFIER_LOOKBACK_LOGS=80
CLASSIFIER_TOPIC_SIM_THRESHOLD=0.78
CLASSIFIER_TASK_SIM_THRESHOLD=0.80
CLASSIFIER_EMBED_MODEL=BAAI/bge-small-en-v1.5
# Note: if you override CLASSIFIER_EMBED_MODEL, keep CLAWBOARD_VECTOR_MODEL in sync for best semantic search.
# CLAWBOARD_VECTOR_MODEL=BAAI/bge-small-en-v1.5
# CLAWBOARD_VECTOR_DB_PATH=./data/classifier_embeddings.db
# Semantic search ingestion policy:
# 0 (default): exclude action logs that are tool call/result/error traces from embeddings + semantic recall.
# 1: include tool activity logs in semantic indexing/retrieval.
CLAWBOARD_SEARCH_INCLUDE_TOOL_CALL_LOGS=0
# Search safety caps (protect API/gateway under aggressive UI search workloads).
# CLAWBOARD_SEARCH_EFFECTIVE_LIMIT_TOPICS=180
# CLAWBOARD_SEARCH_EFFECTIVE_LIMIT_TASKS=360
# CLAWBOARD_SEARCH_EFFECTIVE_LIMIT_LOGS=600
# CLAWBOARD_SEARCH_WINDOW_MULTIPLIER=4
# CLAWBOARD_SEARCH_WINDOW_MIN_LOGS=1200
# CLAWBOARD_SEARCH_WINDOW_MAX_LOGS=5000
# CLAWBOARD_SEARCH_SINGLE_TOKEN_WINDOW_MAX_LOGS=900
# CLAWBOARD_SEARCH_CONCURRENCY_LIMIT=2
# CLAWBOARD_SEARCH_CONCURRENCY_WAIT_SECONDS=0.15
# CLAWBOARD_SEARCH_LOG_CONTENT_MATCH_CLIP_CHARS=2400
# CLAWBOARD_SEARCH_SOURCE_TOPK_MULTIPLIER=6
# CLAWBOARD_SEARCH_SOURCE_TOPK_MIN=120
# CLAWBOARD_SEARCH_SOURCE_TOPK_MAX=960
# CLAWBOARD_RERANK_CHUNKS_PER_DOC=6
# CLAWBOARD_SEARCH_EMBED_QUERY_CACHE_SIZE=256
# CLAWBOARD_SEARCH_DIRECT_LABEL_EXACT_BOOST=0.38
# CLAWBOARD_SEARCH_DIRECT_LABEL_PREFIX_BOOST=0.2
# CLAWBOARD_SEARCH_DIRECT_LABEL_COVERAGE_BOOST=0.16

# Embeddings/search index (Qdrant is enabled by default in docker-compose)
QDRANT_URL=http://qdrant:6333
QDRANT_COLLECTION=clawboard_embeddings
QDRANT_DIM=384
# Optional: if your Qdrant uses API key auth
# QDRANT_API_KEY=

# Optional: enrich classifier with OpenClaw memory snippets
# Mount the host memory dir into the classifier container and point to the sqlite file.
# Example volume: ~/.openclaw/memory:/data/openclaw-memory:ro
OPENCLAW_MEMORY_DB_PATH=/data/openclaw-memory/main.sqlite
OPENCLAW_MEMORY_DB_FALLBACK=/data/openclaw-memory/main.sqlite
OPENCLAW_MEMORY_MAX_HITS=6

# Optional: restrict CORS
# CLAWBOARD_CORS_ORIGINS=http://localhost:3010

# Optional: trust X-Forwarded-For / X-Real-IP from your reverse proxy.
# Leave unset (default) unless you control the proxy boundary.
# CLAWBOARD_TRUST_PROXY=0

# Optional (docker web-dev profile): tweak file watching (polling is slower but reliable on Docker Desktop).
# CLAWBOARD_WEB_WATCHPACK_POLLING=true
# CLAWBOARD_WEB_WATCHPACK_POLLING_INTERVAL=1000
# Optional (docker web-dev profile): prewarm heavy routes after startup to avoid slow first-hit compiles.
# CLAWBOARD_WEB_DEV_PREWARM=true
# CLAWBOARD_WEB_DEV_PREWARM_PATHS="/ /u /graph /log /stats"
# CLAWBOARD_WEB_DEV_PREWARM_TIMEOUT_MS=180000
# CLAWBOARD_WEB_DEV_READY_PROBE_PATH=/favicon.ico

# Optional: server-side precompiled response snapshots for heavy endpoints (/api/clawgraph, /api/changes, /api/metrics).
# Enabled by default for both dev and prod. Disable only when debugging cache behavior.
# CLAWBOARD_PRECOMPILE_ENABLED=1
# CLAWBOARD_PRECOMPILE_TTL_SECONDS=8
# CLAWBOARD_PRECOMPILE_MAX_KEYS=32
# CLAWBOARD_PRECOMPILE_WARM_ON_STARTUP=1
# CLAWBOARD_PRECOMPILE_WARM_LISTENER_ENABLED=1
# CLAWBOARD_PRECOMPILE_WARM_MIN_INTERVAL_SECONDS=1.5
